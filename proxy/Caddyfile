# Hephaestus Homelab - Secure Caddy Configuration
# All services protected with basic authentication

# Global configuration
{
    admin 127.0.0.1:2019
    auto_https off
    http_port 80
    
    # Global logging configuration
    log {
        level INFO
        format json
        output file /data/logs/caddy.json {
            roll_size 50mb
            roll_keep 10
            roll_keep_for 720h
        }
    }
}

# Localhost health endpoint (no auth)
localhost:80 {
    respond /health "OK" 200
}

# Default route - Cloudflare Tunnel entry point
:80 {
    # Unauthenticated health endpoint for container healthcheck
    @health path /health
    handle @health {
        respond "OK" 200
    }

    # www subdomain redirect to main domain
    @www host www.chrislawrence.ca
    handle @www {
        redir https://chrislawrence.ca{uri} 301
    }

    # Redirect homepage to portfolio (no auth required)
    @homepage path /
    handle @homepage {
        redir / /portfolio/ 302
    }

    # Portfolio App (no auth required - public)
    @portfolio path /portfolio/*
    handle @portfolio {
        uri strip_prefix /portfolio
        reverse_proxy portfolio:5000 {
            header_up X-Forwarded-Prefix /portfolio
        }
    }

    # SchedShare route moved to main domain section below

    # MagicPages API (Public) - Port 8100
    @magicpages {
        path /magicpages-api/*
    }
    handle @magicpages {
        uri strip_prefix /magicpages-api
        reverse_proxy magicpages-api:8000 {
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
            header_up X-Real-IP {remote}
        }
    }

    # MagicPages Static Files (CSS, JS, Images)
    @magicpages_static {
        path /magicpages-api/static/*
    }
    handle @magicpages_static {
        uri strip_prefix /magicpages-api/static
        file_server {
            root /var/www/magicpages/static
        }
    }

    # MagicPages Media Files (User uploads)
    @magicpages_media {
        path /magicpages-api/media/*
    }
    handle @magicpages_media {
        uri strip_prefix /magicpages-api/media
        file_server {
            root /var/www/magicpages/media
        }
    }

    # Direct port access works better for Organizr embedding
    # Use http://192.168.50.70:PORT/path in Organizr tab URLs

    # Dashboard/Organizr (Protected) - for remote access
    @dashboard {
        path /dashboard/*
    }
    handle @dashboard {
        reverse_proxy organizr:80 {
            header_up Host {host}
        }
    }

    # Infrastructure services (for remote access)
    handle_path /uptime {
        reverse_proxy uptime-kuma:3001 {
            header_down -X-Frame-Options
        }
    }
    
    handle_path /uptime/* {
        reverse_proxy uptime-kuma:3001 {
            header_down -X-Frame-Options
        }
    }

    handle_path /docker {
        reverse_proxy portainer:9000 {
            header_down -X-Frame-Options
        }
    }
    
    handle_path /docker/* {
        reverse_proxy portainer:9000 {
            header_down -X-Frame-Options
        }
    }

    handle_path /metrics {
        reverse_proxy grafana:3000 {
            header_down -X-Frame-Options
        }
    }
    
    handle_path /metrics/* {
        reverse_proxy grafana:3000 {
            header_down -X-Frame-Options
        }
    }

    handle_path /prometheus/* {
        reverse_proxy prometheus:9090
    }

    handle_path /containers/* {
        reverse_proxy cadvisor:8080
    }

    handle_path /system/* {
        reverse_proxy glances:61208
    }

    handle_path /tools/* {
        reverse_proxy it-tools:80
    }

    # IoT Services (for remote access)
    handle_path /mqtt/* {
        reverse_proxy mqtt-explorer:4000 {
            header_down -X-Frame-Options
        }
    }

    handle_path /homeassistant/* {
        reverse_proxy homeassistant:8123 {
            header_down -X-Frame-Options
        }
    }

    handle_path /nodered/* {
        reverse_proxy node-red:1880 {
            header_up Connection {http.request.header.Connection}
            header_up Upgrade {http.request.header.Upgrade}
            header_down -X-Frame-Options
        }
    }

    handle_path /grafana-iot/* {
        reverse_proxy grafana-iot:3000 {
            header_down -X-Frame-Options
        }
    }

    # Application Services (for remote access)
    handle_path /n8n/* {
        reverse_proxy n8n-stack-n8n-1:5678 {
            header_up Connection {http.request.header.Connection}
            header_up Upgrade {http.request.header.Upgrade}
            header_down -X-Frame-Options
        }
    }

    handle_path /notes/* {
        reverse_proxy obsidian-notes:3000 {
            header_up Authorization "Basic b2JzaWRpYW46b2JzaWRpYW4xMjM="
            header_up Connection {http.request.header.Connection}
            header_up Upgrade {http.request.header.Upgrade}
            header_down -X-Frame-Options
        }
    }

    # Fallback removed - handled by main domain routing

    # Enhanced logging for main domain
    log {
        level INFO
        format json
        output file /data/logs/main-domain.json {
            roll_size 25mb
            roll_keep 10
            roll_keep_for 168h
        }
    }
    
    # Error logging for main domain
    log {
        level ERROR
        format json
        output file /data/logs/main-domain-errors.json {
            roll_size 5mb
            roll_keep 15
            roll_keep_for 72h
        }
    }
}

# n8n subdomain removed in favor of path routing under chrislawrence.ca



# Dashboard subdomain (single subdomain)
dashboard.chrislawrence.ca {
    reverse_proxy organizr:80

    # Enhanced logging for dashboard
    log {
        level INFO
        format json
        output file /data/logs/dashboard.json {
            roll_size 15mb
            roll_keep 8
            roll_keep_for 168h
        }
    }
    
    # Error logging for dashboard
    log {
        level ERROR
        format json
        output file /data/logs/dashboard-errors.json {
            roll_size 3mb
            roll_keep 10
            roll_keep_for 72h
        }
    }
}

# Uptime Kuma proxy for Organizr embedding (port 8083)
:8083 {

    reverse_proxy uptime-kuma:3001 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# Portainer proxy for Organizr embedding (port 8084)
:8084 {

    reverse_proxy portainer:9000 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# Grafana proxy for Organizr embedding (port 8085)
:8085 {

    reverse_proxy grafana:3000 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# Prometheus proxy for Organizr embedding (port 8086)
:8086 {

    reverse_proxy prometheus:9090 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# cAdvisor proxy for Organizr embedding (port 8087)
:8087 {

    reverse_proxy cadvisor:8080 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# Glances proxy for Organizr embedding (port 8088)
:8088 {

    reverse_proxy glances:61208 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# IT-Tools proxy for Organizr embedding (port 8089)
:8089 {

    reverse_proxy it-tools:80 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# Obsidian Notes proxy for Organizr embedding (port 8090)
:8090 {
    reverse_proxy obsidian-notes:3000 {
        # Enable WebSocket support for the app
        header_up Connection {http.request.header.Connection}
        header_up Upgrade {http.request.header.Upgrade}
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
        # Force HTTP for embedding compatibility
        header_up X-Forwarded-Proto http
        header_up X-Forwarded-Ssl off
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# (Removed per-service subdomains in favor of chrislawrence.ca subpaths)

# Magic Pages API proxy for Organizr embedding (port 8091)
:8091 {

    reverse_proxy magicpages-api:8000 {
        # Set correct host header for Django ALLOWED_HOSTS
        header_up Host localhost
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# n8n proxy for Organizr embedding (port 8092)
:8092 {
    reverse_proxy n8n-stack-n8n-1:5678 {
        # Enable WebSocket support for n8n editor
        header_up Connection {http.request.header.Connection}
        header_up Upgrade {http.request.header.Upgrade}
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# MQTT Explorer proxy for Organizr embedding (port 8093)
:8093 {

    reverse_proxy mqtt-explorer:4000 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# Home Assistant proxy for Organizr embedding (port 8094)
:8094 {
    basic_auth {
        admin $2a$14$w9sGeM752W5OBJfOXiRSWupEl2w75yu5WNIuNF9KMjBz42B4rrR7S
    }

    reverse_proxy homeassistant:8123 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# Node-RED proxy for Organizr embedding (port 8095)
:8095 {

    reverse_proxy node-red:1880 {
        # Enable WebSocket support for Node-RED editor
        header_up Connection {http.request.header.Connection}
        header_up Upgrade {http.request.header.Upgrade}
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# Grafana IoT proxy for Organizr embedding (port 8096)
:8096 {

    reverse_proxy grafana-iot:3000 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# CapitolScope Backend proxy for Organizr embedding (port 8120)
:8120 {

    reverse_proxy capitolscope-dev:8000 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# CapitolScope Frontend proxy for Organizr embedding (port 8121)
:8121 {

    reverse_proxy capitolscope-frontend-dev:5173 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# ============================================================================
# AI SERVICES PROXY PORTS (816X ports - for Organizr embedding)
# ============================================================================

# Open WebUI proxy for Organizr embedding (port 8161)
:8161 {
    reverse_proxy ai-openwebui:8080 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# ComfyUI proxy for Organizr embedding (port 8162)
:8162 {
    reverse_proxy ai-comfyui:8188 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# OpenRouter Proxy for Organizr embedding (port 8163)
:8163 {
    reverse_proxy ai-openrouter-proxy:8190 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# Model Manager proxy for Organizr embedding (port 8164)
:8164 {
    reverse_proxy ai-model-manager:8191 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# daedalOS proxy for Organizr embedding (port 8158)
:8158 {
    reverse_proxy daedalos:3000 {
        # Remove X-Frame-Options to allow embedding
        header_down -X-Frame-Options
        header_down -Content-Security-Policy
    }

    # Set permissive headers for embedding
    header {
        -X-Frame-Options
        Content-Security-Policy "frame-ancestors *"
    }
}

# ============================================================================
# DEV SUBDOMAIN ROUTING - dev.chrislawrence.ca
# ============================================================================

# Dev subdomain with all homelab services
dev.chrislawrence.ca {
    # Security headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    # Redirect homepage to dashboard
    @homepage path /
    handle @homepage {
        redir / /dashboard/ 302
    }

    # Dashboard/Organizr (Protected) - Cloudflare Access required
    handle_path /dashboard {
        reverse_proxy organizr:80
    }
    
    handle_path /dashboard/* {
        reverse_proxy organizr:80
    }

    # Infrastructure services (Protected) - Cloudflare Access required
    handle_path /uptime {
        reverse_proxy uptime-kuma:3001 {
            header_down -X-Frame-Options
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }
    
    handle_path /uptime/* {
        reverse_proxy uptime-kuma:3001 {
            header_down -X-Frame-Options
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }

    handle_path /docker {
        reverse_proxy portainer:9000 {
            header_down -X-Frame-Options
        }
    }
    
    handle_path /docker/* {
        reverse_proxy portainer:9000 {
            header_down -X-Frame-Options
        }
    }

    handle_path /metrics {
        reverse_proxy grafana:3000 {
            header_down -X-Frame-Options
        }
    }
    
    handle_path /metrics/* {
        reverse_proxy grafana:3000 {
            header_down -X-Frame-Options
        }
    }

    handle_path /prometheus/* {
        reverse_proxy prometheus:9090
    }

    handle_path /containers/* {
        reverse_proxy cadvisor:8080
    }

    handle_path /system/* {
        reverse_proxy glances:61208
    }

    handle_path /tools/* {
        reverse_proxy it-tools:80
    }

    # ========================================================================
    # APPLICATION ROUTES (81XX ports - ACTIVE)
    # ========================================================================
    
    # Portfolio App (Public) - Port 8110
    handle_path /portfolio/* {
        reverse_proxy portfolio:5000 {
            header_up X-Forwarded-Prefix /portfolio
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
            header_up X-Real-IP {remote}
        }
    }

    # Minecraft BlueMap (Public) - Port 8159 (embeddable)
    handle_path /minecraft-map/* {
        reverse_proxy minecraft:8100 {
            # Remove frame-blocking headers from BlueMap
            header_down -X-Frame-Options
            header_down -Content-Security-Policy
        }
        # Allow embedding in Organizr
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self' dev.chrislawrence.ca"
        }
    }

    # Magic Pages API (Public) - Port 8100
    handle_path /magicpages-api/* {
        reverse_proxy magicpages-api:8000 {
            # Set correct host header for Django ALLOWED_HOSTS
            header_up Host localhost
        }
        header {
            Access-Control-Allow-Origin "*"
            Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            Access-Control-Allow-Headers "Content-Type, Authorization, X-API-Key"
        }
    }

    # Magic Pages Frontend (Public) - Port 8101
    handle_path /magicpages/* {
        reverse_proxy magicpages-frontend:80
    }

    # daedalOS Browser OS (Public) - Port 8158
    handle_path /os/* {
        reverse_proxy daedalos:3000 {
            header_down -X-Frame-Options
            header_down -Content-Security-Policy
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }

    # CapitolScope Backend API (Public) - Port 8120
    handle_path /capitolscope/api/* {
        reverse_proxy capitolscope:8000
        header {
            Access-Control-Allow-Origin "*"
            Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            Access-Control-Allow-Headers "Content-Type, Authorization"
        }
    }

    # CapitolScope Frontend (Public) - Port 8121
    handle_path /capitolscope/ {
        reverse_proxy capitolscope-frontend:5173
        header {
            Access-Control-Allow-Origin "*"
            Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            Access-Control-Allow-Headers "Content-Type, Authorization"
        }
    }

    # Mongo Events Demo (Public) - Port 8140
    handle_path /events/* {
        reverse_proxy mongo-events:5000
        header {
            Access-Control-Allow-Origin "*"
            Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            Access-Control-Allow-Headers "Content-Type, Authorization"
        }
    }

    # SchedShare (Public) - Port 8130
    handle_path /schedshare {
        redir /schedshare /schedshare/home 302
    }
    
    handle_path /schedshare/* {
        reverse_proxy schedshare:5000 {
            header_up X-Forwarded-Prefix /schedshare
            header_up Host {host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-For {remote}
            header_up X-Real-IP {remote}
        }
    }

    # EventSphere (alias for events) - Port 8140
    handle_path /eventsphere/* {
        reverse_proxy mongo-events:5000
        header {
            Access-Control-Allow-Origin "*"
            Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            Access-Control-Allow-Headers "Content-Type, Authorization"
        }
    }

    # n8n Workflow Automation (Protected) - Port 8092
    handle_path /n8n/* {
        reverse_proxy n8n-stack-n8n-1:5678 {
            # Enable WebSocket support for n8n editor
            header_up Connection {http.request.header.Connection}
            header_up Upgrade {http.request.header.Upgrade}
            header_down -X-Frame-Options
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }

    # Obsidian Notes (Protected) - Port 8060
    handle_path /notes/* {
        reverse_proxy obsidian-notes:3000 {
            # Pass authentication headers
            header_up Authorization "Basic b2JzaWRpYW46b2JzaWRpYW4xMjM="
            # Enable WebSocket support
            header_up Connection {http.request.header.Connection}
            header_up Upgrade {http.request.header.Upgrade}
            header_down -X-Frame-Options
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }

    # ========================================================================
    # AI INFERENCE SERVICES (816X ports)
    # ========================================================================
    
    # Open WebUI (Protected) - Port 8161
    handle_path /ai/* {
        reverse_proxy ai-openwebui:8080 {
            header_down -X-Frame-Options
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }
    
    # ComfyUI (Protected) - Port 8162
    handle_path /comfyui/* {
        reverse_proxy ai-comfyui:8188 {
            header_down -X-Frame-Options
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }
    
    # OpenRouter Proxy (Protected) - Port 8163
    handle_path /openrouter/* {
        reverse_proxy ai-openrouter-proxy:8190
    }
    
    # Model Manager (Protected) - Port 8164
    handle_path /models/* {
        reverse_proxy ai-model-manager:8191 {
            header_down -X-Frame-Options
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }

    # ========================================================================
    # IOT & COMMUNICATION SERVICES (815X ports)
    # ========================================================================
    
    # MQTT Explorer (Public) - Port 8152
    handle_path /mqtt/* {
        reverse_proxy mqtt-explorer:4000 {
            header_down -X-Frame-Options
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }

    # Home Assistant (Public) - Port 8154
    handle_path /homeassistant/* {
        reverse_proxy homeassistant:8123 {
            header_down -X-Frame-Options
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }

    # Node-RED IoT Automation (Protected) - Port 8155
    handle_path /nodered/* {
        reverse_proxy node-red:1880 {
            # Enable WebSocket support for Node-RED editor
            header_up Connection {http.request.header.Connection}
            header_up Upgrade {http.request.header.Upgrade}
            header_down -X-Frame-Options
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }

    # Grafana IoT Dashboard (Protected) - Port 8156
    handle_path /grafana-iot/* {
        reverse_proxy grafana-iot:3000 {
            header_down -X-Frame-Options
        }
        header {
            -X-Frame-Options
            Content-Security-Policy "frame-ancestors 'self'"
        }
    }

    # InfluxDB API (Protected) - Port 8157
    handle_path /influxdb/* {
        reverse_proxy influxdb:8086
    }

    # Fallback for any unmatched paths - return 404
    handle {
        respond "Not Found" 404
    }
    
    # Comprehensive logging for dev subdomain
    log {
        level INFO
        format json
        output file /data/logs/dev-chrislawrence-ca.json {
            roll_size 50mb
            roll_keep 15
            roll_keep_for 720h
        }
    }
    
    # Error logging for dev subdomain
    log {
        level ERROR
        format json
        output file /data/logs/dev-chrislawrence-ca-errors.json {
            roll_size 10mb
            roll_keep 25
            roll_keep_for 168h
        }
    }
    
    # Access logging for dev subdomain
    log {
        level INFO
        format json
        output file /data/logs/dev-chrislawrence-ca-access.log {
            roll_size 100mb
            roll_keep 5
            roll_keep_for 168h
        }
    }
}